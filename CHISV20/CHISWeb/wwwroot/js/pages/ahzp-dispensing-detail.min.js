function setShow(n,t){var i=null;i=typeof t=="string"?$(t):$(t).parents(".layui-tab-item");n?i.removeClass("ah-pay-hidelist"):i.addClass("ah-pay-hidelist");$(".layui-tab-title li span").each(function(){n?$(this).html(""):$(this).html("<i class='glyphicon glyphicon-triangle-bottom' style='margin-left:10px'><\/i>")})}function refreshDispensingSummary(){$.post("/Dispensing/LoadDispensingDetailSumary",{treatId:pagedata.treatId},function(n){$("#dispensing_summary").html(n)})}var DISPENSING={SearchData:function(){var n=$('div[ah-id="DISPENSINT"]').first();return{dispensingStatus:n.find('input[name="dispensingStatus"]:checked').val(),startDate:n.find('input[ah-id="startDate"]').first().val(),endDate:n.find('input[ah-id="endDate"]').first().val(),searchText:n.find('input[ah-id="searchText"]').first().val()}},GetSendList:function(){var n=this.SearchData();$.post("/Dispensing/GetSendList",{searchText:n.searchText,dispensingStatus:n.dispensingStatus,tstart:n.startDate,tend:n.endDate},function(n){$('div[ah-id="DISPENSINT-TABLE"]').html(n)})},addDispensingRmk:function(n){var t=$(n).parents("tr").first(),i=t.attr("ah-type"),r=t.attr("ah-drugId"),u=t.attr("ah-dbid");$.open({type:2,title:"未发药备注",area:["500px","auto"],content:["/dispensing/DispensingRmk?drugType="+i+"&drugId="+r+"&dbid="+u]})},SetDispensingStatus:function(n,t,i,r,u){$.ajax({url:"/Dispensing/SetDispensingStatus",dataType:"json",data:{drugType:n,drugId:t,dbid:i,Rmk:r,state:u},success:function(n){if(n.rlt){var t=$("tr[ah-dbid='"+i+"']"),f;u===2?(t.attr("class","ah-drug-despnesing-state-2"),f="待退"):(t.attr("class","ah-drug-despnesing-state-0"),f="待发");t.find("td[ah-route='Status']").html(f);t.find("td[ah-route='Rmk']").html(r)}else layer.msg(n.msg)}})},SendDrugLocalHerb:function(n){var t=$(n).parents('table[ah-id="herb-section"]'),i=t.attr("ah-treatId"),u=t.attr("ah-PrescriptionNo"),r=[];t.find(".ah-drug-despnesing-state-0").each(function(){r.push(parseInt($(this).attr("ah-drugId")))});$.post("/Dispensing/SendDrug_LocalHerb",{drugs:r,treatId:i,prescriptionNo:u},function(n){n.rlt?($.ok("发药成功！"),console.log("123123"),$.post("/Dispensing/LoadDispensingDetailsOfStore",{sourceFrom:0,treatId:i,supplierId:0},function(n){console.log("23232");console.log(n);var i=t.parents(".ah-drug-table").first();i.before(n);i.remove()})):layer.msg(n.msg)},"json")},SendDrugLocalFormed:function(n){var t=$(n).parents('table[ah-id="formed-section"]'),i=t.attr("ah-treatId"),u=t.attr("ah-supplierId"),f=t.attr("ah-PrescriptionNo"),r=[];t.find(".ah-drug-despnesing-state-0").each(function(){r.push(parseInt($(this).attr("ah-drugId")))});$.post("/Dispensing/SendDrug_LocalFormed",{drugs:r,treatId:i,supplierId:u,prescriptionNo:f},function(n){n.rlt?($.ok("发药成功！"),$.post("/Dispensing/LoadDispensingDetailsOfStore",{sourceFrom:0,treatId:i,supplierId:0},function(n){console.log(n);var i=t.parents(".ah-drug-table").first();i.before(n);i.remove()})):layer.msg(n.msg)},"json")},SendDrugWebAll:function(n){try{var t=$(n).parents('table[ah-id="formed-section"]'),i=t.attr("ah-treatId"),u=t.attr("ah-supplierId"),f=t.find("input[ah-id=SendRmk]").val(),r=[];t.find(".ah-drug-despnesing-state-0").each(function(){r.push(parseInt($(this).attr("ah-drugId")))});$.post("/Dispensing/SendDrug_Web",{drugs:r,treatId:i,supplierId:u,SendRmk:f},function(n){n.rlt?($.ok("发药成功！"),$.post("/Dispensing/LoadDispensingDetailsOfStore",{sourceFrom:1,treatId:i,supplierId:3},function(n){console.log(n);var i=t.parents(".ah-drug-table").first();i.before(n);i.remove()})):layer.msg(n.msg)},"json")}catch(e){$.err(e)}},RefreshDispensingMonitor:function(){$("#sumary").load("/Dispensing/LoadDispensingDetailSumary",{treatId:pagedata.treatId})}},CHARGE={getUrlRegInit:function(){var t=new RegExp("(^|&)treatId=([^&]*)(&|$)"),n=window.location.search.substr(1).match(t);n!=null&&CHARGE.chargeNeedPayInfo(n[2])},setPayCode:function(){$.post("/Charge/GetBarcodeUrl",{},function(n){n.rlt?($("#test1").attr("href",n.BarcodePayMonitorUrl),$("#ah-set-payCode").qrcode({text:n.BarcodePayMonitorUrl,width:150,height:150})):$.err(n.msg)});$(document).on("click touchstart",function(n){n=window.event||n;obj=$(n.srcElement||n.target);$(obj).parents(".ah-set-payCode").first().length<=0&&$(obj).parents(".charge-set-wrap").first().length<=0&&$(obj).attr("class")!="charge-set-wrap"&&$(".ah-set-payCode").hide()});$("#set-pay-code").click(function(){$(".ah-set-payCode").toggle("fast",function(){})})},returnDetail:function(){window.location.href="/Charge/CHIS_Charge"},modifyAddressCallback:function(n,t){console.log(t);t=="pay"?$.loadUrl("/Charge/CHIS_Charge?pagefn=23&treatId="+n):t=="dispensing"&&(window.location.href="/Dispensing/DispensingDetail?pagefn=105&&treatId="+n)},chargeNeedPayInfo:function(n){$.post("/Charge/LoadCustomerNeedPayDetail",{treatId:n},function(n){$("div[ah-id='chargeIndex']").html(n)})},chargePayedInfo:function(n){$.post("/Charge/LoadCustomerPayedDetail",{payedId:n},function(n){$("div[ah-id='chargeIndex']").html(n)})},ChangeAddress:function(n,t,i,r){var u=$(n).parents('[ah-d-section="customer_address"]').first(),e=u.find('[ah-d-name="AddressId"]').first(),o=u.find('[ah-d-name="AddressDetails"]').first(),f=$("#TreatId").val();console.log(r);$.open({type:2,title:"选择地址",area:["50%","715px"],content:["/dispensing/ChangeAddress?customerId="+t+"&selectedAddressId="+i+"&treatId="+f+"&type="+r],end:function(){}})},getChargeDrugInfo:function(n){var t=$(n).parent().hasClass("ah-charge-drug-info");$(".ah-charge-drug-info").each(function(){$(this).removeClass("ah-charge-drug-info")});t||$(n).parent().addClass("ah-charge-drug-info")},getChargeListNeedPay:function(n){var t=$("#search_need_pay_input").val(),i=$(n).parents("form").first().find("[name=bAllClinic]").is(":checked");$.post("/Charge/GetChargeListNeedPay",{searchText:t,bAllClinic:i},function(n){$("div[id='wait_payment']").html(n);$.updataAllLayui()})},getChargeListPayed:function(n){var t=$("#search_pay_input").val(),i=$(n).parents("form").first().find("[name=bAllClinic]").is(":checked");$.post("/Charge/GetChargeListPayed",{searchText:t,bAllClinic:i},function(n){$("div[id='already_payment']").html(n);$.updataAllLayui()})}},PAYMENT={Payment:function(n,t){var u=t.is(":checked"),r,i;t.prop("checked",!1);$.updataAllLayui();r=document.body.clientWidth;i={type:2,shadeClose:!1,closeBtn:0,title:'支付<span class="ah-open-titleTips">(如若网络支付失败，请点击二维码下方对应支付的图片进行刷新)<\/span>',content:["/Charge/ChargePayment?treatid="+n+"&isReOrder="+u],end:function(){}};r>1280&&(i.area=["680px","650px"]);$.open(i)},PayMentSuccess:function(n){$.ajax({url:"/Charge/ChargePaymentSuccess",dataType:"json",data:n,success:function(n){if(n.rlt)if($.ok("支付成功！"),n.bAutoSendDrug)var t=4,i=setInterval(function(){t>0&&$.get("/openapi/Dispensing/SendAllDrugsByPayOrderId",{payOrderId:n.payOrderId},function(n){n.rlt?($.ok("自动发药成功"),t=0,CHARGE.returnDetail(),clearInterval(i)):t==0&&(clearInterval(i),$.alertError("请手动发药，自动发药失败："+n.msg),CHARGE.returnDetail())});t--;t<=0&&clearInterval(i)},500);else CHARGE.returnDetail();else $.alertError("暂未查询到相关支付！ 支付未成功:"+n.msg)}})},PaymentFailTips:function(){$.err("如网络原因，请刷新后重新支付！")}},CHARGELIST={LoadChargeList:function(n){var t=$("#search").find("[name=searchText]").val(),i=$("#search").find("[name=dt0]").val(),r=$("#search").find("[name=dt1]").val();$.post("/Charge/LoadChargeList",{searchText:t,dt0:i,dt1:r,pageIndex:n},function(n){$('div[ah-id="CHARGELIST-TABLE"]').html(n)})},ChargeListDetail:function(n){layer.open({type:2,title:"收费明细详情",area:["60%","70%"],content:["/Charge/ChargeListDetail?payId="+$(n).attr("ah-pid")]})}};$(function(){$(".ah-drugSumary-tab").on("click","li",function(){var n=$(this),t="ah-drugList-border-"+n.attr("ah-type");n.attr("ah-type")=="all"?n.parents(".ah-dispensing-left").first().find("li").each(function(){$(this).hasClass("ah-drugList-title")||$(this).parent().hasClass("ah-drugSumary-tab")||$(this).css("display","flex")}):n.parents(".ah-dispensing-left").first().find("li").each(function(){$(this).hasClass("ah-drugList-title")||$(this).hasClass(t)||$(this).parent().hasClass("ah-drugSumary-tab")?$(this).css("display","flex"):$(this).hide()});$(".scrollbar-dynamic").each(function(){$(this).scrollbar()})})});
//# sourceMappingURL=ahzp-dispensing-detail.min.js.map